{% block extracss %}
<link rel="stylesheet" href="/static/css/compose.css">
{% endblock %}
{% block extrajs %}
  <script src="/static/js/jquery.form.js" type="text/javascript" charset="utf-8"></script>
  <script>
    $('#compose form').ajaxForm(function(data, status, xhr) {
      // We check the response data; the response code would be OK if we got
      // redirected to a compose form with an error message.
      if (data.trim() == "OK") {
        $('#id_body, #id_submit').attr('disabled', true);
        $('#compose .error').hide();
        $('#compose .success').fadeIn();
      } else {
        $('#compose .error').fadeIn();
      }
    });
  </script>
{% endblock %}
<div id="compose">
  <form class="compose" action="{% url messages_compose_embedded %}" method="POST">
    {% csrf_token %}
    <input type="hidden" name="recipient" id="id_recipient" value="{{ wish.user.user.username }}"/>
    <fieldset>
      <legend>Send a message to this user</legend>
      <div>
        {# Separate input.hidden to not have to override all the input CSS... #}
        <input type="hidden" name="subject" id="id_subject" value="{{ contact_subject }}">
        Subject: {{ contact_subject }}
      </div>
      <textarea id="id_body" rows="4" cols="55" name="body"></textarea>
      <div>
        <input id="id_submit" type="submit" value="Send &raquo;"/>
        <span class="success" style="display: none">Your message has been sent!</span>
        <span class="error" style="display: none">Sorry, an error occurred. Please try again.</span>
      </div>
    </fieldset>
  </form>
</div>
